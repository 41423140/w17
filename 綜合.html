<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Brython éŠæˆ²ä¸­å¿ƒ</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .game-card {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            backdrop-filter: blur(10px);
        }
        
        .game-card:hover {
            transform: translateY(-8px);
            border-color: #00dbde;
            box-shadow: 0 10px 30px rgba(0, 219, 222, 0.2);
        }
        
        .game-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .game-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .game-desc {
            color: #bbb;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 219, 222, 0.3);
        }
        
        .game-area {
            display: none;
            margin-top: 30px;
            background: rgba(20, 20, 35, 0.9);
            border-radius: 15px;
            padding: 25px;
            min-height: 500px;
            border: 2px solid #00dbde;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .back-btn {
            background: #444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #555;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        canvas {
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            background: #000;
            border: 2px solid #333;
        }
        
        .todo-area {
            display: none;
            margin-top: 30px;
        }
        
        /* å¾…è¾¦äº‹é …ç‰¹å®šæ¨£å¼ */
        .todo-container {
            background: white;
            border-radius: 12px;
            padding: 2em 3em;
            color: #333;
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            max-width: 900px;
            margin: 0 auto;
        }
        
        .input-area {
            display: flex;
            gap: 1em;
            align-items: flex-end;
            margin-bottom: 1.8em;
        }
        
        .inputs {
            flex: 1 1 0;
            display: flex;
            gap: 1em;
        }
        
        .todo-input {
            width: 100%;
            padding: 0.7em 1em;
            border: 1.5px solid #d1d9e6;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }
        
        .todo-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.4);
        }
        
        #task_input {
            flex: 3 1 0;
        }
        
        #datetime_input {
            flex: 2 1 0;
        }
        
        #location_input {
            flex: 2 1 0;
        }
        
        #add_btn {
            flex: 0 0 150px;
            background-color: #3498db;
            border: none;
            color: white;
            font-size: 1.2em;
            padding: 0.8em 0;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.5);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        #add_btn:hover {
            background-color: #2980b9;
            box-shadow: 0 6px 16px rgba(41, 128, 185, 0.7);
        }
        
        #task_list {
            list-style: none;
            padding: 0;
            margin-top: 2em;
            max-height: 450px;
            overflow-y: auto;
        }
        
        #task_list li {
            background: #ecf0f1;
            padding: 1.2em 1.5em;
            border-radius: 12px;
            margin-bottom: 1em;
            position: relative;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }
        
        #task_list li:hover {
            background-color: #d6eaf8;
        }
        
        .task-title {
            font-weight: 700;
            font-size: 1.15em;
            color: #2c3e50;
        }
        
        .task-info {
            margin-top: 0.4em;
            font-size: 0.9em;
            color: #5d6d7e;
            user-select: none;
        }
        
        .delete-btn {
            position: absolute;
            top: 1.1em;
            right: 1.1em;
            background: #e74c3c;
            border: none;
            color: white;
            padding: 0.4em 0.8em;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.6);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
            box-shadow: 0 3px 10px rgba(192, 57, 43, 0.8);
        }
        
        .today-task {
            border-left: 6px solid #3498db !important;
            background-color: #d6eaf8 !important;
        }
        
        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .game-card {
                padding: 20px;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .inputs {
                flex-direction: column;
            }
            
            #add_btn {
                width: 100%;
            }
        }
    </style>
</head>
<body onload="brython()">
    <div class="container">
        <header>
            <h1>ğŸ® Brython éŠæˆ²ä¸­å¿ƒ</h1>
            <p class="subtitle">é¸æ“‡ä¸€æ¬¾éŠæˆ²é–‹å§‹æŒ‘æˆ°ï¼Œæˆ–æ˜¯ç®¡ç†ä½ çš„å¾…è¾¦äº‹é …</p>
        </header>
        
        <div class="game-grid" id="gameGrid">
            <div class="game-card" data-game="todo">
                <div class="game-icon">ğŸ“</div>
                <h3 class="game-title">å¾…è¾¦äº‹é …ç®¡ç†</h3>
                <p class="game-desc">ç®¡ç†ä½ çš„ä»»å‹™ã€è¨­å®šæ™‚é–“åœ°é»ï¼Œä¸¦æ¥æ”¶é€šçŸ¥æé†’</p>
                <div class="game-stats">
                    <span>ğŸ“… æ™‚é–“ç®¡ç†</span>
                    <span>ğŸ”” æ™ºæ…§æé†’</span>
                </div>
                <button class="play-btn" id="todoBtn">é–‹å§‹ä½¿ç”¨</button>
            </div>
            
            <div class="game-card" data-game="shooter">
                <div class="game-icon">ğŸ¯</div>
                <h3 class="game-title">æ˜Ÿéš›å°„æ“Šæˆ°</h3>
                <p class="game-desc">WSADç§»å‹•ï¼Œæ»‘é¼ ç„æº–å°„æ“Šï¼Œæ¶ˆæ»…ä¾†è¥²çš„æ•µäºº</p>
                <div class="game-stats">
                    <span>âš¡ å¿«é€Ÿåæ‡‰</span>
                    <span>ğŸ® é›™é‡æ“ä½œ</span>
                </div>
                <button class="play-btn" id="shooterBtn">é–‹å§‹éŠæˆ²</button>
            </div>
            
            <div class="game-card" data-game="dodge">
                <div class="game-icon">ğŸƒ</div>
                <h3 class="game-title">èº²é¿çƒæŒ‘æˆ°</h3>
                <p class="game-desc">ç§»å‹•ç¶ çƒé¿é–‹ç´…çƒï¼Œæ”¶é›†é“å…·ç²å¾—é¡å¤–åˆ†æ•¸</p>
                <div class="game-stats">
                    <span>ğŸ§  åæ‡‰åŠ›</span>
                    <span>ğŸŒŸ é“å…·æ”¶é›†</span>
                </div>
                <button class="play-btn" id="dodgeBtn">é–‹å§‹éŠæˆ²</button>
            </div>
            
            <div class="game-card" data-game="clicker">
                <div class="game-icon">ğŸŸ¥</div>
                <h3 class="game-title">æ¥µé€Ÿé»æ“Šæ–¹å¡Š</h3>
                <p class="game-desc">åœ¨æ™‚é–“å…§é»æ“Šç´…è‰²æ–¹å¡Šï¼Œæ¸¬è©¦ä½ çš„åæ‡‰é€Ÿåº¦</p>
                <div class="game-stats">
                    <span>â±ï¸ æ™‚é–“æŒ‘æˆ°</span>
                    <span>ğŸ‘† é»æ“Šæº–ç¢º</span>
                </div>
                <button class="play-btn" id="clickerBtn">é–‹å§‹éŠæˆ²</button>
            </div>
            
            <div class="game-card" data-game="spacewar">
                <div class="game-icon">ğŸš€</div>
                <h3 class="game-title">æ˜Ÿéš›æˆ°çˆ­</h3>
                <p class="game-desc">é§•é§›é£›èˆ¹åœ¨æ˜Ÿéš›ä¸­æˆ°é¬¥ï¼Œèº²é¿æ•µäººçš„æ”»æ“Š</p>
                <div class="game-stats">
                    <span>ğŸŒŒ æ˜Ÿéš›èƒŒæ™¯</span>
                    <span>ğŸ¯ å¤šç¨®æ•µäºº</span>
                </div>
                <button class="play-btn" id="spacewarBtn">é–‹å§‹éŠæˆ²</button>
            </div>
        </div>
        
        <!-- å¾…è¾¦äº‹é …å€åŸŸ -->
        <div class="todo-area" id="todoArea"></div>
        
        <!-- éŠæˆ²å€åŸŸ -->
        <div class="game-area" id="gameArea">
            <div class="game-header">
                <h2 id="gameTitle">éŠæˆ²è¼‰å…¥ä¸­...</h2>
                <button class="back-btn" id="backBtn">è¿”å›ä¸»é¸å–®</button>
            </div>
            <div class="game-container" id="gameContainer"></div>
        </div>
    </div>

    <script type="text/python">
# å°å…¥å¿…è¦çš„æ¨¡çµ„
from browser import document, window, html, timer, alert
import json
import random
import math
import time
import datetime

# ==================== å…¨åŸŸè®Šæ•¸ ====================
current_game = None
game_timers = []
todo_storage_key = 'brython_todo_list'

# ==================== ä¸»é¸å–®åŠŸèƒ½ ====================
def show_main_menu(event=None):
    """é¡¯ç¤ºä¸»é¸å–®"""
    document["gameGrid"].style.display = "grid"
    document["gameArea"].style.display = "none"
    document["todoArea"].style.display = "none"
    
    # æ¸…é™¤æ‰€æœ‰éŠæˆ²è¨ˆæ™‚å™¨
    for t in game_timers:
        try:
            timer.clear_interval(t)
        except:
            pass
    game_timers.clear()

# ==================== å¾…è¾¦äº‹é …æ‡‰ç”¨ ====================
def load_todo_app(event=None):
    """è¼‰å…¥å¾…è¾¦äº‹é …æ‡‰ç”¨"""
    document["gameGrid"].style.display = "none"
    document["gameArea"].style.display = "none"
    todo_area = document["todoArea"]
    todo_area.style.display = "block"
    todo_area.clear()
    
    # å»ºç«‹å¾…è¾¦äº‹é …ä»‹é¢
    container = html.DIV(Class="todo-container")
    
    # æ¨™é¡Œ
    title = html.H2("ğŸ“ å¾…è¾¦äº‹é …æ¸…å–®")
    title.style.textAlign = "center"
    title.style.color = "#2c3e50"
    title.style.marginBottom = "1.5em"
    container <= title
    
    # è¼¸å…¥å€åŸŸ
    input_area = html.DIV(Class="input-area")
    
    inputs_div = html.DIV(Class="inputs")
    
    task_input = html.INPUT(type="text", id="task_input", Class="todo-input", placeholder="è¼¸å…¥ä»»å‹™åç¨±")
    datetime_input = html.INPUT(type="datetime-local", id="datetime_input", Class="todo-input")
    location_input = html.INPUT(type="text", id="location_input", Class="todo-input", placeholder="è¼¸å…¥åœ°é»")
    
    inputs_div <= task_input
    inputs_div <= datetime_input
    inputs_div <= location_input
    
    add_btn = html.BUTTON("ï¼‹ æ–°å¢ä»»å‹™", id="add_btn")
    
    input_area <= inputs_div
    input_area <= add_btn
    
    # ä»»å‹™åˆ—è¡¨
    task_list = html.UL(id="task_list")
    
    container <= input_area
    container <= task_list
    
    # è¿”å›æŒ‰éˆ•
    back_btn = html.BUTTON("â† è¿”å›éŠæˆ²ä¸­å¿ƒ", Class="back-btn")
    back_btn.style.marginTop = "20px"
    back_btn.bind("click", show_main_menu)
    
    todo_area <= container
    todo_area <= back_btn
    
    # åˆå§‹åŒ–å¾…è¾¦äº‹é …åŠŸèƒ½
    init_todo_functionality()

def init_todo_functionality():
    """åˆå§‹åŒ–å¾…è¾¦äº‹é …åŠŸèƒ½"""
    
    def save_tasks(tasks):
        """å„²å­˜ä»»å‹™åˆ°localStorage"""
        window.localStorage.setItem(todo_storage_key, json.dumps(tasks))
    
    def load_tasks():
        """å¾localStorageè¼‰å…¥ä»»å‹™"""
        data = window.localStorage.getItem(todo_storage_key)
        if data:
            try:
                return json.loads(data)
            except:
                return []
        return []
    
    def render_task(task, index):
        """æ¸²æŸ“å–®å€‹ä»»å‹™"""
        li = html.LI()
        
        # æª¢æŸ¥æ˜¯å¦ç‚ºä»Šå¤©çš„ä»»å‹™
        is_today = False
        dt_str = task.get('datetime')
        if dt_str:
            try:
                task_date = datetime.datetime.strptime(dt_str[:10], '%Y-%m-%d').date()
                if task_date == datetime.date.today():
                    is_today = True
            except:
                pass
        
        if is_today:
            li.classList.add('today-task')
        
        # ä»»å‹™æ¨™é¡Œ
        title_div = html.DIV(Class="task-title")
        title_div.text = task['title']
        li <= title_div
        
        # ä»»å‹™è³‡è¨Š
        info_parts = []
        if dt_str:
            display_time = dt_str.replace('T', ' ')
            info_parts.append(f"â° {display_time}")
        if task.get('location'):
            info_parts.append(f"ğŸ“ {task['location']}")
        
        if info_parts:
            info_div = html.DIV(Class="task-info")
            info_div.text = " | ".join(info_parts)
            li <= info_div
        
        # åˆªé™¤æŒ‰éˆ•
        del_btn = html.BUTTON("ğŸ—‘ï¸ åˆªé™¤", Class="delete-btn")
        
        def delete_task(event):
            tasks = load_tasks()
            if 0 <= index < len(tasks):
                tasks.pop(index)
                save_tasks(tasks)
                refresh_task_list()
        
        del_btn.bind("click", delete_task)
        li <= del_btn
        
        return li
    
    def refresh_task_list():
        """åˆ·æ–°ä»»å‹™åˆ—è¡¨"""
        task_list = document["task_list"]
        task_list.clear()
        
        tasks = load_tasks()
        
        # æŒ‰æ™‚é–“æ’åº
        def get_task_time(task):
            dt_str = task.get('datetime')
            if dt_str:
                try:
                    return datetime.datetime.strptime(dt_str, '%Y-%m-%dT%H:%M')
                except:
                    return datetime.datetime.max
            return datetime.datetime.max
        
        sorted_tasks = sorted(tasks, key=get_task_time)
        
        # æ¸²æŸ“æ‰€æœ‰ä»»å‹™
        for i, task in enumerate(sorted_tasks):
            task_list <= render_task(task, i)
        
        # æª¢æŸ¥ä¸¦ç™¼é€ä»Šæ—¥ä»»å‹™é€šçŸ¥
        check_today_tasks_notification(sorted_tasks)
    
    def check_today_tasks_notification(tasks):
        """æª¢æŸ¥ä¸¦ç™¼é€ä»Šæ—¥ä»»å‹™é€šçŸ¥"""
        if not hasattr(window, 'Notification'):
            return
        
        today_str = datetime.date.today().strftime('%Y-%m-%d')
        today_tasks = [t for t in tasks if t.get('datetime', '').startswith(today_str)]
        
        if not today_tasks:
            return
        
        def show_notification():
            title = "ğŸ“… ä»Šæ—¥å¾…è¾¦äº‹é …æé†’"
            body = f"ä½ ä»Šå¤©æœ‰ {len(today_tasks)} é …å¾…è¾¦äº‹é …"
            options = {"body": body, "icon": "https://cdn-icons-png.flaticon.com/512/3067/3067256.png"}
            window.Notification.new(title, options)
        
        if window.Notification.permission == "granted":
            show_notification()
        elif window.Notification.permission != "denied":
            def permission_callback(permission):
                if permission == "granted":
                    show_notification()
            window.Notification.requestPermission().then(permission_callback)
    
    def add_new_task(event=None):
        """æ–°å¢ä»»å‹™"""
        title = document["task_input"].value.strip()
        datetime_val = document["datetime_input"].value
        location = document["location_input"].value.strip()
        
        if not title:
            alert("è«‹è¼¸å…¥ä»»å‹™åç¨±ï¼")
            return
        
        tasks = load_tasks()
        tasks.append({
            'title': title,
            'datetime': datetime_val,
            'location': location
        })
        save_tasks(tasks)
        
        # æ¸…ç©ºè¼¸å…¥æ¡†
        document["task_input"].value = ''
        document["datetime_input"].value = ''
        document["location_input"].value = ''
        
        refresh_task_list()
    
    def handle_enter_key(event):
        """è™•ç†Enteréµ"""
        if event.keyCode == 13:  # Enteréµ
            add_new_task()
    
    # ç¶å®šäº‹ä»¶
    document["add_btn"].bind("click", add_new_task)
    document["task_input"].bind("keydown", handle_enter_key)
    document["location_input"].bind("keydown", handle_enter_key)
    
    # åˆå§‹è¼‰å…¥ä»»å‹™
    refresh_task_list()

# ==================== éŠæˆ²è¼‰å…¥åŠŸèƒ½ ====================
def load_game(game_type, event=None):
    """è¼‰å…¥æŒ‡å®šéŠæˆ²"""
    global current_game
    current_game = game_type
    
    document["gameGrid"].style.display = "none"
    document["todoArea"].style.display = "none"
    game_area = document["gameArea"]
    game_container = document["gameContainer"]
    game_area.style.display = "block"
    
    # è¨­ç½®éŠæˆ²æ¨™é¡Œ
    game_titles = {
        'shooter': 'ğŸ¯ æ˜Ÿéš›å°„æ“Šæˆ°',
        'dodge': 'ğŸƒ èº²é¿çƒæŒ‘æˆ°',
        'clicker': 'ğŸŸ¥ æ¥µé€Ÿé»æ“Šæ–¹å¡Š',
        'spacewar': 'ğŸš€ æ˜Ÿéš›æˆ°çˆ­'
    }
    document["gameTitle"].text = game_titles.get(game_type, "éŠæˆ²")
    
    # æ¸…é™¤èˆŠéŠæˆ²
    game_container.clear()
    
    # è¼‰å…¥å°æ‡‰éŠæˆ²
    if game_type == 'shooter':
        init_shooter_game(game_container)
    elif game_type == 'dodge':
        init_dodge_game(game_container)
    elif game_type == 'clicker':
        init_clicker_game(game_container)
    elif game_type == 'spacewar':
        init_spacewar_game(game_container)

# ==================== å°„æ“ŠéŠæˆ² ====================
def init_shooter_game(container):
    """åˆå§‹åŒ–å°„æ“ŠéŠæˆ²"""
    
    # å‰µå»ºéŠæˆ²å…ƒç´ 
    canvas = html.CANVAS(id="shooterCanvas", width=600, height=450)
    
    info_div = html.DIV(id="shooterInfo")
    info_div.style.margin = "15px 0"
    info_div.style.fontSize = "18px"
    
    restart_btn = html.BUTTON("ğŸ”„ é‡æ–°é–‹å§‹", id="shooterRestart")
    restart_btn.style.display = "none"
    restart_btn.style.marginTop = "10px"
    restart_btn.style.padding = "8px 16px"
    restart_btn.style.background = "#3498db"
    restart_btn.style.color = "white"
    restart_btn.style.border = "none"
    restart_btn.style.borderRadius = "6px"
    restart_btn.style.cursor = "pointer"
    
    container <= canvas
    container <= info_div
    container <= restart_btn
    
    # å°„æ“ŠéŠæˆ²é‚è¼¯
    class ShooterGame:
        def __init__(self):
            self.canvas = document["shooterCanvas"]
            self.ctx = self.canvas.getContext("2d")
            self.info = document["shooterInfo"]
            self.restart_btn = document["shooterRestart"]
            
            self.W = self.canvas.width
            self.H = self.canvas.height
            
            # ç©å®¶å±¬æ€§
            self.player = {
                "x": self.W // 2,
                "y": self.H // 2,
                "r": 15,
                "speed": 6,
                "hp": 100,
                "max_hp": 100,
                "level": 1,
                "score": 0,
                "shoot_cooldown": 0.15,
                "last_shot": 0,
                "bullet_power": 1,
                "speed_buff": 0,
                "dx": 0,
                "dy": -1
            }
            
            # éŠæˆ²ç‰©ä»¶
            self.bullets = []
            self.enemies = []
            self.items = []
            
            # éŠæˆ²ç‹€æ…‹
            self.running = True
            self.mouse_pos = {"x": self.player["x"], "y": self.player["y"]}
            self.mouse_down = False
            self.keys = {"w": False, "a": False, "s": False, "d": False}
            
            # è¨ˆæ™‚å™¨
            self.last_enemy_spawn = 0
            self.enemy_spawn_interval = 1400
            self.last_item_spawn = 0
            self.item_spawn_interval = 8000
            
            # ç¶å®šäº‹ä»¶
            self.bind_events()
            
            # å•Ÿå‹•éŠæˆ²å¾ªç’°
            self.game_timer = timer.set_interval(self.game_loop, 16)
            game_timers.append(self.game_timer)
        
        def bind_events(self):
            """ç¶å®šéŠæˆ²äº‹ä»¶"""
            document.bind("keydown", self.on_key_down)
            document.bind("keyup", self.on_key_up)
            self.canvas.bind("mousemove", self.on_mouse_move)
            self.canvas.bind("mousedown", self.on_mouse_down)
            self.canvas.bind("mouseup", self.on_mouse_up)
            self.restart_btn.bind("click", self.restart)
        
        def on_key_down(self, event):
            """è™•ç†æŒ‰éµæŒ‰ä¸‹"""
            key = event.key.lower()
            if key in self.keys:
                self.keys[key] = True
        
        def on_key_up(self, event):
            """è™•ç†æŒ‰éµé‡‹æ”¾"""
            key = event.key.lower()
            if key in self.keys:
                self.keys[key] = False
        
        def on_mouse_move(self, event):
            """è™•ç†æ»‘é¼ ç§»å‹•"""
            rect = self.canvas.getBoundingClientRect()
            self.mouse_pos["x"] = event.clientX - rect.left
            self.mouse_pos["y"] = event.clientY - rect.top
        
        def on_mouse_down(self, event):
            """è™•ç†æ»‘é¼ æŒ‰ä¸‹"""
            if event.button == 0:
                self.mouse_down = True
        
        def on_mouse_up(self, event):
            """è™•ç†æ»‘é¼ é‡‹æ”¾"""
            if event.button == 0:
                self.mouse_down = False
        
        def distance(self, obj1, obj2):
            """è¨ˆç®—å…©é»è·é›¢"""
            dx = obj1["x"] - obj2["x"]
            dy = obj1["y"] - obj2["y"]
            return math.sqrt(dx*dx + dy*dy)
        
        def draw_circle(self, x, y, r, color):
            """ç¹ªè£½åœ“å½¢"""
            self.ctx.beginPath()
            self.ctx.arc(x, y, r, 0, 2 * math.pi)
            self.ctx.fillStyle = color
            self.ctx.fill()
            self.ctx.closePath()
        
        def spawn_enemy(self):
            """ç”Ÿæˆæ•µäºº"""
            enemy_type = random.choice(["chaser", "linear", "bouncer"])
            x = random.randint(20, self.W - 20)
            y = -20
            
            enemy = {
                "type": enemy_type,
                "x": x,
                "y": y,
                "r": 15,
                "hp": 2 + self.player["level"] // 2,
                "speed": 1.5 + self.player["level"] * 0.2,
                "vx": 0,
                "vy": 0
            }
            
            if enemy_type == "linear":
                enemy["vx"] = random.uniform(-1, 1)
                enemy["vy"] = enemy["speed"]
            elif enemy_type == "bouncer":
                enemy["vx"] = random.uniform(-2, 2)
                enemy["vy"] = enemy["speed"] * 0.7
            
            self.enemies.append(enemy)
        
        def spawn_item(self):
            """ç”Ÿæˆé“å…·"""
            item_type = random.choice(["heal", "speed"])
            item = {
                "x": random.randint(15, self.W - 15),
                "y": -15,
                "r": 10,
                "type": item_type,
                "vy": 2,
                "duration": 5000
            }
            self.items.append(item)
        
        def update_player(self):
            """æ›´æ–°ç©å®¶ç‹€æ…‹"""
            # ç§»å‹•
            dx = dy = 0
            if self.keys["w"]: dy -= 1
            if self.keys["s"]: dy += 1
            if self.keys["a"]: dx -= 1
            if self.keys["d"]: dx += 1
            
            dist = math.sqrt(dx*dx + dy*dy)
            if dist > 0:
                dx /= dist
                dy /= dist
                
                speed_mult = 1.8 if self.player["speed_buff"] > time.time() * 1000 else 1
                self.player["x"] += dx * self.player["speed"] * speed_mult
                self.player["y"] += dy * self.player["speed"] * speed_mult
            
            # é‚Šç•Œæª¢æŸ¥
            self.player["x"] = max(self.player["r"], min(self.W - self.player["r"], self.player["x"]))
            self.player["y"] = max(self.player["r"], min(self.H - self.player["r"], self.player["y"]))
            
            # ç„æº–æ–¹å‘
            mx, my = self.mouse_pos["x"], self.mouse_pos["y"]
            pdx = mx - self.player["x"]
            pdy = my - self.player["y"]
            pdist = math.sqrt(pdx*pdx + pdy*pdy)
            if pdist > 0:
                self.player["dx"] = pdx / pdist
                self.player["dy"] = pdy / pdist
        
        def shoot(self):
            """ç™¼å°„å­å½ˆ"""
            now = time.time()
            if now - self.player["last_shot"] < self.player["shoot_cooldown"]:
                return
            
            self.player["last_shot"] = now
            speed = 10
            self.bullets.append({
                "x": self.player["x"],
                "y": self.player["y"],
                "vx": self.player["dx"] * speed,
                "vy": self.player["dy"] * speed,
                "r": 5
            })
        
        def update_bullets(self):
            """æ›´æ–°å­å½ˆ"""
            for bullet in self.bullets[:]:
                bullet["x"] += bullet["vx"]
                bullet["y"] += bullet["vy"]
                
                # ç§»é™¤è¶…å‡ºé‚Šç•Œçš„å­å½ˆ
                if (bullet["x"] < 0 or bullet["x"] > self.W or 
                    bullet["y"] < 0 or bullet["y"] > self.H):
                    self.bullets.remove(bullet)
        
        def update_enemies(self):
            """æ›´æ–°æ•µäºº"""
            for enemy in self.enemies[:]:
                # æ ¹æ“šé¡å‹ç§»å‹•
                if enemy["type"] == "chaser":
                    dx = self.player["x"] - enemy["x"]
                    dy = self.player["y"] - enemy["y"]
                    dist = math.sqrt(dx*dx + dy*dy)
                    if dist > 0:
                        enemy["vx"] = dx / dist * enemy["speed"]
                        enemy["vy"] = dy / dist * enemy["speed"]
                elif enemy["type"] == "linear":
                    if enemy["x"] <= enemy["r"] or enemy["x"] >= self.W - enemy["r"]:
                        enemy["vx"] *= -1
                elif enemy["type"] == "bouncer":
                    if enemy["x"] <= enemy["r"] or enemy["x"] >= self.W - enemy["r"]:
                        enemy["vx"] *= -1
                    if enemy["y"] <= enemy["r"] or enemy["y"] >= self.H - enemy["r"]:
                        enemy["vy"] *= -1
                
                enemy["x"] += enemy["vx"]
                enemy["y"] += enemy["vy"]
                
                # ç§»é™¤è¶…å‡ºé‚Šç•Œçš„æ•µäºº
                if enemy["y"] > self.H + enemy["r"]:
                    self.enemies.remove(enemy)
        
        def update_items(self):
            """æ›´æ–°é“å…·"""
            for item in self.items[:]:
                item["y"] += item["vy"]
                if item["y"] > self.H + item["r"]:
                    self.items.remove(item)
        
        def check_collisions(self):
            """æª¢æŸ¥ç¢°æ’"""
            # å­å½ˆèˆ‡æ•µäººç¢°æ’
            for bullet in self.bullets[:]:
                for enemy in self.enemies[:]:
                    if self.distance(bullet, enemy) < bullet["r"] + enemy["r"]:
                        enemy["hp"] -= self.player["bullet_power"]
                        
                        if enemy["hp"] <= 0:
                            self.enemies.remove(enemy)
                            self.player["score"] += 1
                            
                            # æ¯5æ®ºå‡ç´š
                            if self.player["score"] % 5 == 0:
                                self.player["level"] += 1
                                self.player["bullet_power"] += 1
                                self.player["max_hp"] += 10
                                self.player["hp"] = self.player["max_hp"]
                        
                        if bullet in self.bullets:
                            self.bullets.remove(bullet)
                        break
            
            # æ•µäººèˆ‡ç©å®¶ç¢°æ’
            for enemy in self.enemies[:]:
                if self.distance(self.player, enemy) < self.player["r"] + enemy["r"]:
                    self.player["hp"] -= 15
                    self.enemies.remove(enemy)
                    
                    if self.player["hp"] <= 0:
                        self.running = False
            
            # é“å…·èˆ‡ç©å®¶ç¢°æ’
            for item in self.items[:]:
                if self.distance(self.player, item) < self.player["r"] + item["r"]:
                    if item["type"] == "heal":
                        self.player["hp"] = min(self.player["max_hp"], self.player["hp"] + 30)
                    elif item["type"] == "speed":
                        self.player["speed_buff"] = time.time() * 1000 + item["duration"]
                    
                    self.items.remove(item)
        
        def draw_game(self):
            """ç¹ªè£½éŠæˆ²ç•«é¢"""
            # æ¸…ç©ºç•«å¸ƒ
            self.ctx.clearRect(0, 0, self.W, self.H)
            
            # ç¹ªè£½é“å…·
            for item in self.items:
                color = "lime" if item["type"] == "speed" else "pink"
                self.draw_circle(item["x"], item["y"], item["r"], color)
            
            # ç¹ªè£½å­å½ˆ
            for bullet in self.bullets:
                self.draw_circle(bullet["x"], bullet["y"], bullet["r"], "yellow")
            
            # ç¹ªè£½æ•µäºº
            for enemy in self.enemies:
                if enemy["type"] == "chaser":
                    color = "#ff4444"
                elif enemy["type"] == "linear":
                    color = "#ff9933"
                else:
                    color = "#cc44ff"
                
                self.draw_circle(enemy["x"], enemy["y"], enemy["r"], color)
                
                # è¡€æ¢
                hp_ratio = enemy["hp"] / (2 + self.player["level"] // 2)
                self.ctx.fillStyle = "red"
                self.ctx.fillRect(
                    enemy["x"] - enemy["r"],
                    enemy["y"] - enemy["r"] - 8,
                    enemy["r"] * 2 * hp_ratio,
                    4
                )
            
            # ç¹ªè£½ç©å®¶
            self.draw_circle(self.player["x"], self.player["y"], self.player["r"], "lime")
            
            # ç©å®¶è¡€æ¢
            hp_ratio = self.player["hp"] / self.player["max_hp"]
            self.ctx.fillStyle = "red"
            self.ctx.fillRect(
                self.player["x"] - self.player["r"],
                self.player["y"] - self.player["r"] - 10,
                self.player["r"] * 2 * hp_ratio,
                6
            )
            
            # ç„æº–ç·š
            self.ctx.beginPath()
            self.ctx.moveTo(self.player["x"], self.player["y"])
            self.ctx.lineTo(
                self.player["x"] + self.player["dx"] * self.player["r"] * 1.5,
                self.player["y"] + self.player["dy"] * self.player["r"] * 1.5
            )
            self.ctx.strokeStyle = "white"
            self.ctx.lineWidth = 3
            self.ctx.stroke()
            self.ctx.closePath()
            
            # æ›´æ–°è³‡è¨Š
            self.info.text = f"åˆ†æ•¸: {self.player['score']} | ç­‰ç´š: {self.player['level']} | è¡€é‡: {int(self.player['hp'])}"
        
        def game_loop(self):
            """éŠæˆ²ä¸»å¾ªç’°"""
            if not self.running:
                # éŠæˆ²çµæŸç•«é¢
                self.ctx.fillStyle = "rgba(0, 0, 0, 0.7)"
                self.ctx.fillRect(0, 0, self.W, self.H)
                
                self.ctx.fillStyle = "white"
                self.ctx.font = "32px Arial"
                self.ctx.textAlign = "center"
                self.ctx.textBaseline = "middle"
                self.ctx.fillText("éŠæˆ²çµæŸï¼", self.W // 2, self.H // 2 - 30)
                self.ctx.fillText(f"æœ€çµ‚åˆ†æ•¸: {self.player['score']}", self.W // 2, self.H // 2 + 20)
                
                self.restart_btn.style.display = "inline-block"
                return
            
            # æ›´æ–°éŠæˆ²ç‹€æ…‹
            self.update_player()
            self.update_bullets()
            self.update_enemies()
            self.update_items()
            
            # å°„æ“Š
            if self.mouse_down:
                self.shoot()
            
            # æª¢æŸ¥ç¢°æ’
            self.check_collisions()
            
            # ç”Ÿæˆæ–°æ•µäºº
            now_ms = time.time() * 1000
            if now_ms - self.last_enemy_spawn > self.enemy_spawn_interval:
                self.spawn_enemy()
                self.last_enemy_spawn = now_ms
            
            # ç”Ÿæˆæ–°é“å…·
            if now_ms - self.last_item_spawn > self.item_spawn_interval:
                self.spawn_item()
                self.last_item_spawn = now_ms
            
            # ç¹ªè£½éŠæˆ²
            self.draw_game()
        
        def restart(self, event=None):
            """é‡æ–°é–‹å§‹éŠæˆ²"""
            # é‡ç½®ç©å®¶
            self.player.update({
                "x": self.W // 2,
                "y": self.H // 2,
                "r": 15,
                "speed": 6,
                "hp": 100,
                "max_hp": 100,
                "level": 1,
                "score": 0,
                "bullet_power": 1,
                "speed_buff": 0,
                "dx": 0,
                "dy": -1
            })
            
            # æ¸…ç©ºéŠæˆ²ç‰©ä»¶
            self.bullets.clear()
            self.enemies.clear()
            self.items.clear()
            
            # é‡ç½®ç‹€æ…‹
            self.running = True
            self.last_enemy_spawn = 0
            self.last_item_spawn = 0
            
            # éš±è—é‡æ–°é–‹å§‹æŒ‰éˆ•
            self.restart_btn.style.display = "none"
    
    # å•Ÿå‹•éŠæˆ²
    game = ShooterGame()

# ==================== èº²é¿çƒéŠæˆ² ====================
def init_dodge_game(container):
    """åˆå§‹åŒ–èº²é¿çƒéŠæˆ²"""
    
    canvas = html.CANVAS(id="dodgeCanvas", width=400, height=400)
    
    info_div = html.DIV()
    info_div.innerHTML = '''
        ç”Ÿå­˜ç§’æ•¸ï¼š<span id="dodgeTime">0</span> |
        é¡å¤–å¾—åˆ†ï¼š<span id="dodgeBonus">0</span> |
        ç¸½åˆ†ï¼š<span id="dodgeTotal">0</span>
    '''
    info_div.style.margin = "15px 0"
    info_div.style.fontSize = "16px"
    
    restart_btn = html.BUTTON("ğŸ”„ é‡æ–°é–‹å§‹", id="dodgeRestart")
    restart_btn.style.display = "none"
    restart_btn.style.marginTop = "10px"
    restart_btn.style.padding = "8px 16px"
    restart_btn.style.background = "#3498db"
    restart_btn.style.color = "white"
    restart_btn.style.border = "none"
    restart_btn.style.borderRadius = "6px"
    restart_btn.style.cursor = "pointer"
    
    container <= canvas
    container <= info_div
    container <= restart_btn
    
    # èº²é¿çƒéŠæˆ²é‚è¼¯
    class DodgeGame:
        def __init__(self):
            self.canvas = document["dodgeCanvas"]
            self.ctx = self.canvas.getContext("2d")
            self.restart_btn = document["dodgeRestart"]
            
            # ç©å®¶è¨­å®š
            self.player_r = 10
            self.player_x = self.canvas.width // 2
            self.player_y = self.canvas.height // 2
            
            # éŠæˆ²è®Šæ•¸
            self.balls = []
            self.items = []
            self.ball_r = 10
            self.item_r = 8
            self.base_speed = 1.5
            self.speed_mult = 1
            self.bonus = 0
            self.running = True
            self.start_time = time.time()
            
            # ç¶å®šäº‹ä»¶
            self.canvas.bind("mousemove", self.on_mouse_move)
            self.restart_btn.bind("click", self.restart)
            
            # å•Ÿå‹•è¨ˆæ™‚å™¨
            self.update_timer = timer.set_interval(self.update_game, 30)
            self.ball_timer = timer.set_interval(self.add_ball, 1000)
            self.item_timer = timer.set_interval(self.add_item, 4000)
            
            game_timers.extend([self.update_timer, self.ball_timer, self.item_timer])
        
        def on_mouse_move(self, event):
            """è™•ç†æ»‘é¼ ç§»å‹•"""
            rect = self.canvas.getBoundingClientRect()
            self.player_x = event.clientX - rect.left
            self.player_y = event.clientY - rect.top
        
        def draw_circle(self, x, y, r, color):
            """ç¹ªè£½åœ“å½¢"""
            self.ctx.beginPath()
            self.ctx.arc(x, y, r, 0, 2 * math.pi)
            self.ctx.fillStyle = color
            self.ctx.fill()
            self.ctx.closePath()
        
        def add_ball(self):
            """æ–°å¢ç´…çƒ"""
            if not self.running:
                return
            
            speed = self.base_speed * self.speed_mult
            self.balls.append({
                "x": random.randint(self.ball_r, self.canvas.width - self.ball_r),
                "y": -self.ball_r,
                "vx": random.uniform(-1.5, 1.5),
                "vy": random.uniform(speed - 0.5, speed + 0.5)
            })
        
        def add_item(self):
            """æ–°å¢é“å…·"""
            if self.running and random.random() < 0.6:
                self.items.append({
                    "x": random.randint(self.item_r, self.canvas.width - self.item_r),
                    "y": -self.item_r
                })
        
        def update_game(self):
            """æ›´æ–°éŠæˆ²ç‹€æ…‹"""
            if not self.running:
                return
            
            # æ¸…ç©ºç•«å¸ƒ
            self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)
            
            # æ›´æ–°ç´…çƒ
            for ball in self.balls[:]:
                ball["x"] += ball["vx"]
                ball["y"] += ball["vy"]
                
                # ç‰†å£åå½ˆ
                if ball["x"] <= self.ball_r or ball["x"] >= self.canvas.width - self.ball_r:
                    ball["vx"] *= -1
                
                # ç¹ªè£½ç´…çƒ
                self.draw_circle(ball["x"], ball["y"], self.ball_r, "red")
                
                # ç¢°æ’æª¢æ¸¬
                dx = ball["x"] - self.player_x
                dy = ball["y"] - self.player_y
                distance = math.sqrt(dx*dx + dy*dy)
                
                if distance < self.ball_r + self.player_r:
                    self.end_game()
                    return
            
            # ç§»é™¤è¶…å‡ºç•«é¢çš„ç´…çƒ
            self.balls[:] = [b for b in self.balls if b["y"] <= self.canvas.height + self.ball_r]
            
            # æ›´æ–°é“å…·
            for item in self.items[:]:
                item["y"] += 2
                self.draw_circle(item["x"], item["y"], self.item_r, "lime")
                
                # ç¢°æ’æª¢æ¸¬
                dx = item["x"] - self.player_x
                dy = item["y"] - self.player_y
                distance = math.sqrt(dx*dx + dy*dy)
                
                if distance < self.item_r + self.player_r:
                    self.items.remove(item)
                    self.bonus += 5
            
            # ç§»é™¤è¶…å‡ºç•«é¢çš„é“å…·
            self.items[:] = [i for i in self.items if i["y"] <= self.canvas.height]
            
            # ç¹ªè£½ç©å®¶
            self.draw_circle(self.player_x, self.player_y, self.player_r, "green")
            
            # æ›´æ–°åˆ†æ•¸
            seconds = int(time.time() - self.start_time)
            total = seconds + self.bonus
            
            document["dodgeTime"].text = str(seconds)
            document["dodgeBonus"].text = str(self.bonus)
            document["dodgeTotal"].text = str(total)
            
            # æ¯10ç§’å¢åŠ é›£åº¦
            if seconds % 10 == 0 and seconds > 0:
                self.speed_mult += 0.2
        
        def end_game(self):
            """çµæŸéŠæˆ²"""
            self.running = False
            self.ctx.fillStyle = "black"
            self.ctx.font = "20px Arial"
            self.ctx.textAlign = "center"
            self.ctx.textBaseline = "middle"
            
            total = int(document["dodgeTotal"].text)
            self.ctx.fillText(f"éŠæˆ²çµæŸï¼ç¸½åˆ†ï¼š{total}", 
                            self.canvas.width // 2, 
                            self.canvas.height // 2)
            
            self.restart_btn.style.display = "inline-block"
        
        def restart(self, event=None):
            """é‡æ–°é–‹å§‹éŠæˆ²"""
            # é‡ç½®éŠæˆ²ç‹€æ…‹
            self.player_x = self.canvas.width // 2
            self.player_y = self.canvas.height // 2
            self.balls.clear()
            self.items.clear()
            self.speed_mult = 1
            self.bonus = 0
            self.running = True
            self.start_time = time.time()
            
            # æ›´æ–°é¡¯ç¤º
            document["dodgeTime"].text = "0"
            document["dodgeBonus"].text = "0"
            document["dodgeTotal"].text = "0"
            
            # éš±è—é‡æ–°é–‹å§‹æŒ‰éˆ•
            self.restart_btn.style.display = "none"
    
    # å•Ÿå‹•éŠæˆ²
    game = DodgeGame()

# ==================== é»æ“Šæ–¹å¡ŠéŠæˆ² ====================
def init_clicker_game(container):
    """åˆå§‹åŒ–é»æ“Šæ–¹å¡ŠéŠæˆ²"""
    
    canvas = html.CANVAS(id="clickerCanvas", width=400, height=400)
    
    info_div = html.DIV()
    info_div.innerHTML = '''
        åˆ†æ•¸ï¼š<span id="clickerScore">0</span> |
        å‰©é¤˜æ™‚é–“ï¼š<span id="clickerTime">30</span> ç§’
    '''
    info_div.style.margin = "15px 0"
    info_div.style.fontSize = "18px"
    
    container <= canvas
    container <= info_div
    
    # é»æ“Šæ–¹å¡ŠéŠæˆ²é‚è¼¯
    class ClickerGame:
        def __init__(self):
            self.canvas = document["clickerCanvas"]
            self.ctx = self.canvas.getContext("2d")
            
            # éŠæˆ²è®Šæ•¸
            self.score = 0
            self.time_left = 30
            self.box_size = 40
            self.box_x = random.randint(0, self.canvas.width - self.box_size)
            self.box_y = random.randint(0, self.canvas.height - self.box_size)
            self.running = True
            
            # ç¶å®šäº‹ä»¶
            self.canvas.bind("click", self.on_click)
            
            # å•Ÿå‹•è¨ˆæ™‚å™¨
            self.draw_timer = timer.set_interval(self.draw_box, 16)
            self.countdown_timer = timer.set_interval(self.countdown, 1000)
            
            game_timers.extend([self.draw_timer, self.countdown_timer])
            
            # åˆå§‹ç¹ªè£½
            self.update_score()
            self.update_time()
            self.draw_box()
        
        def draw_box(self):
            """ç¹ªè£½æ–¹å¡Š"""
            self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)
            self.ctx.fillStyle = "red"
            self.ctx.fillRect(self.box_x, self.box_y, self.box_size, self.box_size)
        
        def move_box(self):
            """ç§»å‹•æ–¹å¡Šåˆ°éš¨æ©Ÿä½ç½®"""
            self.box_x = random.randint(0, self.canvas.width - self.box_size)
            self.box_y = random.randint(0, self.canvas.height - self.box_size)
            self.draw_box()
        
        def on_click(self, event):
            """è™•ç†é»æ“Šäº‹ä»¶"""
            if not self.running:
                return
            
            x = event.offsetX
            y = event.offsetY
            
            # æª¢æŸ¥æ˜¯å¦é»ä¸­æ–¹å¡Š
            if (self.box_x <= x <= self.box_x + self.box_size and 
                self.box_y <= y <= self.box_y + self.box_size):
                self.score += 1
                self.update_score()
                self.move_box()
        
        def update_score(self):
            """æ›´æ–°åˆ†æ•¸é¡¯ç¤º"""
            document["clickerScore"].text = str(self.score)
        
        def update_time(self):
            """æ›´æ–°æ™‚é–“é¡¯ç¤º"""
            document["clickerTime"].text = str(self.time_left)
        
        def countdown(self):
            """å€’è¨ˆæ™‚"""
            if not self.running:
                return
            
            self.time_left -= 1
            self.update_time()
            
            if self.time_left <= 0:
                self.end_game()
        
        def end_game(self):
            """çµæŸéŠæˆ²"""
            self.running = False
            
            # æ¸…é™¤ç•«å¸ƒ
            self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)
            
            # é¡¯ç¤ºçµæŸè¨Šæ¯
            self.ctx.fillStyle = "black"
            self.ctx.font = "24px Arial"
            self.ctx.textAlign = "center"
            self.ctx.textBaseline = "middle"
            
            self.ctx.fillText(f"éŠæˆ²çµæŸï¼", 
                            self.canvas.width // 2, 
                            self.canvas.height // 2 - 20)
            self.ctx.fillText(f"å¾—åˆ†ï¼š{self.score}", 
                            self.canvas.width // 2, 
                            self.canvas.height // 2 + 20)
    
    # å•Ÿå‹•éŠæˆ²
    game = ClickerGame()

# ==================== æ˜Ÿéš›æˆ°çˆ­éŠæˆ² ====================
def init_spacewar_game(container):
    """åˆå§‹åŒ–æ˜Ÿéš›æˆ°çˆ­éŠæˆ²"""
    
    canvas = html.CANVAS(id="spacewarCanvas", width=600, height=500)
    
    info_div = html.DIV(id="spacewarInfo")
    info_div.innerHTML = '''
        åˆ†æ•¸ï¼š<span id="spacewarScore">0</span> |
        ç”Ÿå‘½ï¼š<span id="spacewarHealth">100</span> |
        é—œå¡ï¼š<span id="spacewarLevel">1</span>
    '''
    info_div.style.margin = "15px 0"
    info_div.style.fontSize = "18px"
    
    restart_btn = html.BUTTON("ğŸ”„ é‡æ–°é–‹å§‹", id="spacewarRestart")
    restart_btn.style.display = "none"
    restart_btn.style.marginTop = "10px"
    restart_btn.style.padding = "8px 16px"
    restart_btn.style.background = "#3498db"
    restart_btn.style.color = "white"
    restart_btn.style.border = "none"
    restart_btn.style.borderRadius = "6px"
    restart_btn.style.cursor = "pointer"
    
    container <= canvas
    container <= info_div
    container <= restart_btn
    
    # æ˜Ÿéš›æˆ°çˆ­éŠæˆ²é‚è¼¯
    class SpaceWarGame:
        def __init__(self):
            self.canvas = document["spacewarCanvas"]
            self.ctx = self.canvas.getContext("2d")
            self.restart_btn = document["spacewarRestart"]
            
            # éŠæˆ²ç‹€æ…‹
            self.score = 0
            self.health = 100
            self.level = 1
            self.running = True
            
            # ç©å®¶è¨­å®š
            self.player_x = 100
            self.player_y = 400
            self.player_w = 60
            self.player_h = 60
            self.player_speed = 6
            
            # éŠæˆ²ç‰©ä»¶
            self.enemies = []
            self.keys = {"w": False, "a": False, "s": False, "d": False}
            self.stars = []
            
            # éŠæˆ²è¨­å®š
            self.spawn_interval = 2000
            self.enemy_speed = 5
            
            # ç”Ÿæˆæ˜Ÿæ˜ŸèƒŒæ™¯
            for _ in range(100):
                self.stars.append([
                    random.randint(0, self.canvas.width),
                    random.randint(0, self.canvas.height)
                ])
            
            # ç¶å®šäº‹ä»¶
            document.bind("keydown", self.on_key_down)
            document.bind("keyup", self.on_key_up)
            self.restart_btn.bind("click", self.restart)
            
            # å•Ÿå‹•è¨ˆæ™‚å™¨
            self.game_timer = timer.set_interval(self.update_game, 50)
            self.enemy_timer = timer.set_interval(self.spawn_enemy, self.spawn_interval)
            
            game_timers.extend([self.game_timer, self.enemy_timer])
        
        def on_key_down(self, event):
            """è™•ç†æŒ‰éµæŒ‰ä¸‹"""
            key = event.key.lower()
            if key in self.keys:
                self.keys[key] = True
        
        def on_key_up(self, event):
            """è™•ç†æŒ‰éµé‡‹æ”¾"""
            key = event.key.lower()
            if key in self.keys:
                self.keys[key] = False
        
        def draw_background(self):
            """ç¹ªè£½æ˜Ÿç©ºèƒŒæ™¯"""
            # æ¼¸å±¤èƒŒæ™¯
            gradient = self.ctx.createLinearGradient(0, 0, 0, self.canvas.height)
            gradient.addColorStop(0, "#001f3d")
            gradient.addColorStop(1, "#1f5b8b")
            self.ctx.fillStyle = gradient
            self.ctx.fillRect(0, 0, self.canvas.width, self.canvas.height)
            
            # æ˜Ÿæ˜Ÿ
            self.ctx.fillStyle = "white"
            for star in self.stars:
                star[1] += 0.2
                if star[1] > self.canvas.height:
                    star[1] = 0
                    star[0] = random.randint(0, self.canvas.width)
                
                self.ctx.beginPath()
                self.ctx.arc(star[0], star[1], 1, 0, math.pi * 2)
                self.ctx.fill()
        
        def draw_player(self):
            """ç¹ªè£½ç©å®¶é£›èˆ¹"""
            # é£›èˆ¹ä¸»é«”
            self.ctx.fillStyle = "#3498db"
            self.ctx.beginPath()
            self.ctx.moveTo(self.player_x + self.player_w/2, self.player_y)
            self.ctx.lineTo(self.player_x + self.player_w, self.player_y + self.player_h/3)
            self.ctx.lineTo(self.player_x + self.player_w/1.5, self.player_y + self.player_h/1.5)
            self.ctx.lineTo(self.player_x + self.player_w/3, self.player_y + self.player_h/1.5)
            self.ctx.lineTo(self.player_x, self.player_y + self.player_h/3)
            self.ctx.closePath()
            self.ctx.fill()
            
            # é§•é§›è‰™
            self.ctx.fillStyle = "#2980b9"
            self.ctx.beginPath()
            self.ctx.arc(self.player_x + self.player_w/2, 
                        self.player_y + self.player_h/3, 
                        self.player_w/4, 0, math.pi * 2)
            self.ctx.fill()
        
        def move_player(self):
            """ç§»å‹•ç©å®¶"""
            if self.keys["w"] and self.player_y > 0:
                self.player_y -= self.player_speed
            if self.keys["s"] and self.player_y < self.canvas.height - self.player_h:
                self.player_y += self.player_speed
            if self.keys["a"] and self.player_x > 0:
                self.player_x -= self.player_speed
            if self.keys["d"] and self.player_x < self.canvas.width - self.player_w:
                self.player_x += self.player_speed
        
        def spawn_enemy(self):
            """ç”Ÿæˆæ•µäºº"""
            if not self.running:
                return
            
            size = random.randint(30, 60)
            x = random.randint(0, self.canvas.width - size)
            enemy_type = random.choice(["UFO", "Missile", "Drone"])
            
            self.enemies.append({
                "x": x,
                "y": -size,
                "size": size,
                "type": enemy_type
            })
        
        def draw_enemies(self):
            """ç¹ªè£½æ•µäºº"""
            for enemy in self.enemies[:]:
                # ç§»å‹•æ•µäºº
                enemy["y"] += self.enemy_speed + self.level // 2
                
                # ç¹ªè£½ä¸åŒé¡å‹çš„æ•µäºº
                if enemy["type"] == "UFO":
                    self.ctx.fillStyle = "#2ecc71"
                    self.ctx.beginPath()
                    self.ctx.ellipse(
                        enemy["x"] + enemy["size"]/2,
                        enemy["y"] + enemy["size"]/2,
                        enemy["size"]/2,
                        enemy["size"]/4,
                        0, 0, math.pi * 2
                    )
                    self.ctx.fill()
                
                elif enemy["type"] == "Missile":
                    self.ctx.fillStyle = "#e74c3c"
                    self.ctx.fillRect(
                        enemy["x"],
                        enemy["y"],
                        enemy["size"]/3,
                        enemy["size"] * 2
                    )
                
                elif enemy["type"] == "Drone":
                    self.ctx.fillStyle = "#95a5a6"
                    self.ctx.fillRect(
                        enemy["x"],
                        enemy["y"],
                        enemy["size"],
                        enemy["size"]/2
                    )
                
                # ç¢°æ’æª¢æ¸¬
                if (self.player_x < enemy["x"] + enemy["size"] and
                    self.player_x + self.player_w > enemy["x"] and
                    self.player_y < enemy["y"] + enemy["size"] and
                    self.player_y + self.player_h > enemy["y"]):
                    
                    self.health -= 10
                    self.enemies.remove(enemy)
                    
                    if self.health <= 0:
                        self.end_game()
                
                # ç§»é™¤è¶…å‡ºç•«é¢çš„æ•µäºº
                if enemy["y"] > self.canvas.height:
                    self.enemies.remove(enemy)
        
        def update_game(self):
            """æ›´æ–°éŠæˆ²ç‹€æ…‹"""
            if not self.running:
                return
            
            # æ¸…ç©ºç•«å¸ƒ
            self.ctx.clearRect(0, 0, self.canvas.width, self.canvas.height)
            
            # ç¹ªè£½éŠæˆ²å…ƒç´ 
            self.draw_background()
            self.draw_player()
            self.move_player()
            self.draw_enemies()
            
            # æ›´æ–°åˆ†æ•¸å’Œç­‰ç´š
            self.score += 1
            if self.score % 500 == 0:
                self.level += 1
            
            # æ›´æ–°é¡¯ç¤º
            document["spacewarScore"].text = str(self.score)
            document["spacewarHealth"].text = str(self.health)
            document["spacewarLevel"].text = str(self.level)
        
        def end_game(self):
            """çµæŸéŠæˆ²"""
            self.running = False
            
            # é¡¯ç¤ºçµæŸç•«é¢
            self.ctx.fillStyle = "rgba(0, 0, 0, 0.8)"
            self.ctx.fillRect(0, 0, self.canvas.width, self.canvas.height)
            
            self.ctx.fillStyle = "white"
            self.ctx.font = "32px Arial"
            self.ctx.textAlign = "center"
            self.ctx.textBaseline = "middle"
            
            self.ctx.fillText("éŠæˆ²çµæŸï¼", 
                            self.canvas.width // 2, 
                            self.canvas.height // 2 - 30)
            self.ctx.fillText(f"æœ€çµ‚åˆ†æ•¸: {self.score}", 
                            self.canvas.width // 2, 
                            self.canvas.height // 2 + 30)
            
            self.restart_btn.style.display = "inline-block"
        
        def restart(self, event=None):
            """é‡æ–°é–‹å§‹éŠæˆ²"""
            # é‡ç½®éŠæˆ²ç‹€æ…‹
            self.score = 0
            self.health = 100
            self.level = 1
            self.running = True
            
            # é‡ç½®ç©å®¶ä½ç½®
            self.player_x = 100
            self.player_y = 400
            
            # æ¸…ç©ºæ•µäºº
            self.enemies.clear()
            
            # æ›´æ–°é¡¯ç¤º
            document["spacewarScore"].text = "0"
            document["spacewarHealth"].text = "100"
            document["spacewarLevel"].text = "1"
            
            # éš±è—é‡æ–°é–‹å§‹æŒ‰éˆ•
            self.restart_btn.style.display = "none"
    
    # å•Ÿå‹•éŠæˆ²
    game = SpaceWarGame()

# ==================== ä¸»ç¨‹å¼å…¥å£ ====================
def main():
    """ä¸»ç¨‹å¼å…¥å£"""
    
    # ç¶å®šä¸»é¸å–®æŒ‰éˆ•
    document["todoBtn"].bind("click", load_todo_app)
    document["shooterBtn"].bind("click", lambda e: load_game('shooter'))
    document["dodgeBtn"].bind("click", lambda e: load_game('dodge'))
    document["clickerBtn"].bind("click", lambda e: load_game('clicker'))
    document["spacewarBtn"].bind("click", lambda e: load_game('spacewar'))
    document["backBtn"].bind("click", show_main_menu)
    
    # é¡¯ç¤ºä¸»é¸å–®
    show_main_menu()
    
    # è«‹æ±‚é€šçŸ¥æ¬Šé™
    if hasattr(window, 'Notification') and window.Notification.permission == "default":
        window.Notification.requestPermission()

# å•Ÿå‹•ä¸»ç¨‹å¼
main()
    </script>
</body>
</html>